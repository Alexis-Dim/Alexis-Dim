<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaceship with More Horizontal Movement and Continuous Shooting</title>
    <style>
        :root {
            --color-dark-green: #0e4429;
            --color-medium-dark-green: #006d32;
            --color-medium-green: #26a641;
            --color-light-green: #39d353;
            --color-non-green: #ffffff;
        }

        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
            position: relative;
            overflow: hidden; /* Prevent scrollbars */
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(53, 12px);
            grid-template-rows: repeat(7, 12px);
            grid-gap: 1px;
            background-color: #e0e0e0;
            padding: 8px;
            border-radius: 3px;
            position: absolute; /* Positioning to overlay on background */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Center the grid */
        }

        .cell {
            width: 12px;
            height: 12px;
            background-color: var(--color-non-green);
            border-radius: 3px;
        }

        .color-dark-green {
            background-color: var(--color-dark-green);
        }
        .color-medium-dark-green {
            background-color: var(--color-medium-dark-green);
        }
        .color-medium-green {
            background-color: var(--color-medium-green);
        }
        .color-light-green {
            background-color: var(--color-light-green);
        }

        .spaceship {
            position: absolute;
            width: 50px;
            height: 50px;
            background: url('./Spaceship.png') no-repeat center center;
            background-size: contain;
            bottom: 50px; /* Fixed position from the bottom */
            left: 50%;
            transform: translateX(-50%);
        }

        .beam {
            position: absolute;
            width: 5px;
            height: 20px;
            background-color: red;
            border-radius: 6px;
            opacity: 1; /* Fully visible */
            transform: translateX(-50%); /* Center horizontally relative to its own left position */
        }
    </style>
</head>
<body>
    <div class="grid"></div>
    <div class="spaceship"></div>

    <script>
        const spaceship = document.querySelector('.spaceship');
        const grid = document.querySelector('.grid');
        const horizontalDiameter = 750; // Larger diameter for more horizontal movement
        const verticalDiameter = 100; // Smaller diameter for slight vertical movement

        // Calculate radii based on diameters
        const horizontalRadius = horizontalDiameter / 2;
        const verticalRadius = verticalDiameter / 2;
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2 + 200;

        let angle = 0; // Initial angle
        let greenBoxCount = 0; // Track number of green boxes
        let animationFrameId; // Track the animation frame ID

        function resetGrid() {
            // Clear the existing grid
            grid.innerHTML = '';

            const totalCells = 7 * 53;
            const colorClasses = [
                'color-dark-green',
                'color-medium-dark-green',
                'color-medium-green',
                'color-light-green'
            ];

            greenBoxCount = 0;

            for (let i = 0; i < totalCells; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');

                if (Math.random() < 0.2) {
                    const randomColorClass = colorClasses[Math.floor(Math.random() * colorClasses.length)];
                    cell.classList.add(randomColorClass);
                    greenBoxCount++;
                }

                grid.appendChild(cell);
            }
        }

        function animate() {
            angle += 0.01; // Increment angle for smooth motion

            // Calculate new position with more horizontal and slight vertical movement
            const x = centerX + horizontalRadius * Math.cos(angle) - spaceship.offsetWidth / 2;
            const y = centerY + verticalRadius * Math.sin(angle * 3) - spaceship.offsetHeight / 2;

            spaceship.style.left = `${x}px`;
            spaceship.style.top = `${y}px`;

            animationFrameId = requestAnimationFrame(animate); // Request next frame
        }

        function createBeam() {
            const beam = document.createElement('div');
            beam.className = 'beam';

            // Get the current position of the spaceship
            const rect = spaceship.getBoundingClientRect();
            const spaceshipX = rect.left + window.scrollX + rect.width / 2; // Center of spaceship horizontally
            const spaceshipY = rect.top + window.scrollY; // Top of spaceship vertically

            // Set initial position of the beam relative to the spaceship
            beam.style.left = `${spaceshipX}px`; // Position the beam horizontally
            beam.style.top = `${spaceshipY}px`; // Position the beam vertically at the top of the spaceship

            document.body.appendChild(beam); // Append to body so it doesn't follow spaceship animation

            // Start the beam movement
            const beamAnimation = requestAnimationFrame(() => moveBeam(beam));
        }

        function moveBeam(beam) {
            const beamRect = beam.getBoundingClientRect();
            const gridRect = grid.getBoundingClientRect();

            // Detect collision with green boxes
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                const cellRect = cell.getBoundingClientRect();
                if (
                    beamRect.left < cellRect.right &&
                    beamRect.right > cellRect.left &&
                    beamRect.top < cellRect.bottom &&
                    beamRect.bottom > cellRect.top &&
                    (cell.classList.contains('color-dark-green') ||
                    cell.classList.contains('color-medium-dark-green') ||
                    cell.classList.contains('color-medium-green') ||
                    cell.classList.contains('color-light-green'))
                ) {
                    cell.className = 'cell'; // Reset to non-green cell
                    beam.remove(); // Remove the beam after the hit
                    greenBoxCount--; // Decrease the count of green boxes

                    if (greenBoxCount === 0) {
                        // All green boxes are hit, restart the animation
                        resetAnimation();
                    }
                }
            });

            // Continue moving the beam upwards
            beam.style.top = `${beam.offsetTop - 5}px`;

            // Remove the beam if it's outside the grid bounds
            if (beam.getBoundingClientRect().top > gridRect.top) {
                requestAnimationFrame(() => moveBeam(beam));
            } else {
                beam.remove(); // Remove the beam if it's out of bounds
            }
        }

        function shootBeamsContinuously() {
            createBeam(); // Create a single beam
            setTimeout(shootBeamsContinuously, 100); // Schedule the next shot
        }

        function resetAnimation() {
            // Stop the current animation
            cancelAnimationFrame(animationFrameId); // Cancel the ongoing animation

            // Reset the grid and green box count
            resetGrid();

            // Reset the angle to prevent cumulative speed
            angle = 0;

            // Restart the spaceship animation
            animate();
        }

        // Initialize the grid and start the animation
        resetGrid();
        animate();
        shootBeamsContinuously(); // Start continuous shooting
    </script>
</body>
</html>
